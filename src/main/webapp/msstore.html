<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/0.16.1/css/semantic.min.css"
          type="text/css"/>
    <link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Open+Sans'/>
    <style>
        * { font-family: 'Open Sans', sans-serif; }
        .ui.thumbnails>.item { cursor: pointer; }
        /*.ui.variations, .ui.sizes { margin-bottom: 20px; }*/
        .ui.connected.variations>.row>.item { width: 40px; min-height: 30px; text-align: center; vertical-align: middle; margin: 4px; padding: 1px; font-size: 0.75em; }
        .ui.connected.variations>.row>.item>.content { padding: 1px; }
        .ui.connected.variations>.row>.item>.content>img { width: 35px; }
        /*.ui.variations>.row>.item:last-child,.ui.sizes>.item:last-child { margin-bottom: 20px; }*/
        .ui.connected.sizes>.row>.item { width: 45px; min-height: 45px; text-align: center; vertical-align: middle; margin: 4px; font-size: 0.75em; }
        .ui.price.tags>.list_price { font-weight: 600; }
        .ui.price.tags>.base_price { text-decoration: line-through; font-size: 0.8em; color: red; }
        .description.tags { font-size: 0.8em; color: gray; margin-bottom: 20px; }
        .ui.basic.segment.main { margin-left: auto; margin-right: auto; }
        .ui.body { width: 1280px; margin-left: auto; margin-right:auto; }
    </style>
    <title>:: the store ::</title>
</head>
<body>
<div class="ui raised segment">
    <div class="ui inverted menu">
        <a class="item">
            <i class="home icon"></i> Home
        </a>
        <div class="ui dropdown item">
            Men
        </div>
        <a class="item">
            Women
        </a>
        <div class="ui dropdown item">
            Goodies
            <div class="menu product_picker">
                <a class="item" data-pid="289171900" data-locale="en_US" data-category="Goodies,Gaming">Xbox Gift Card</a>
                <a class="item" data-pid="275670200" data-locale="en_US" data-category="Goodies,Gaming">Rock Candy Xbox 360 Controller</a>
                <a class="item" data-pid="275244100" data-locale="ja_JP" data-category="Goodies,Computer">Wireless Mobile Mouse 3500</a>
            </div>
        </div>

        <div class="right menu">
            <div class="ui dropdown item">
                <i class="icon globe"></i>
                <div class="ui black tiny label locale_holder">en_US</div>
                <div class="menu locale_picker">
                    <a class="item">en_US</a>
                    <a class="item">en_GB</a>
                    <a class="item">en_IE</a>
                    <a class="item">ja_JP</a>
                    <a class="item">hi_IN</a>
                </div>
            </div>
            <div class="item">
                <div class="ui icon input">
                    <input type="text" placeholder="Search..." class="searcher">
                    <i class="search link icon"></i>
                </div>
            </div>
            <a class="item">
                <i class="user icon"></i>
            </a>
            <a class="item">
                <i class="cart icon"></i>
            </a>
        </div>

    </div>

    <div class="ui basic segment">

        <div class="ui small breadcrumb">
            <a class="section"><i class="circle left icon"></i> Back</a>
            <div class="divider">  &#124;</div>
            <a class="section">Home</a>
            <div class="divider"> /</div>
            <a class="section">Men</a>
            <div class="divider"> /</div>
            <a class="section">Shoes</a>
            <div class="divider"> /</div>
            <div class="active section">VESPA LX LO</div>
        </div>

        <div class="ui grid body">
            <div class="ui active dimmer"><div class="ui large text loader">Loading</div></div>
            <div class="three wide column">
                <div class="ui list thumbnails">

                </div>
            </div>
            <div class="seven wide column">
                <div class="ui segment basic main">
                    <h3 class="ui black header">
                    </h3>
                    <div class="ui price tags">
                        <span class="list_price"></span>
                        <span class="base_price"></span>
                    </div>
                    <div class="ui image pdp">
                        <a class="ui left red corner label">
                            <div class="text">NEW</div>
                        </a>
                        <img src=""/>
                    </div>
                    <div >
                        <div class="description tags">
                        </div>
                        <div class="ui small stars">
                            <i class="icon star"></i>
                            <i class="icon star"></i>
                            <i class="icon star"></i>
                            <i class="icon empty star"></i>
                            <i class="icon empty star"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="five wide column">
                <div class="ui basic segment">
                    <div class="ui form">
                        <div class="fields">
                            <div class="fifteen wide field">
                                <div class="ui connected items variations">
                                </div>
                            </div>
                        </div>
                        <div class="fields">
                            <div class="ten wide field">
                                <div class="ui fluid selection tiny dropdown">
                                    <input type="hidden" name="qty">
                                    <div class="default text">Qty</div>
                                    <i class="dropdown icon"></i>
                                    <div class="menu ui transition hidden">
                                        <div class="item" data-value="male">1</div>
                                        <div class="item" data-value="male">2</div>
                                        <div class="item" data-value="male">3</div>
                                        <div class="item" data-value="male">4</div>
                                        <div class="item" data-value="male">5</div>
                                        <div class="item" data-value="male">6</div>
                                        <div class="item" data-value="male">7</div>
                                        <div class="item" data-value="male">8</div>
                                        <div class="item" data-value="male">9</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="fields">
                            <div class="ten wide field">
                                <div class="ui fluid facebook submit button medium">
                                    <span style="font-size: 0.8rem;">ADD TO CART</span> <i class="cart outline icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>


</div>
<script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore.js"></script>
<script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
<script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/0.16.1/javascript/semantic.js"></script>
<script type="application/javascript">
    var data;

    var default_pid = '275670200';
    var default_category = 'Goodies,Gaming';

    $(document).ready(function() {
        $('.ui.dropdown').dropdown();
        $('.menu.locale_picker>.item').on('click', function() {
            $('.locale_holder').text($(this).text());
        });
        $('.menu.product_picker>.item').on('click', function() {
            var pid = $(this).attr('data-pid');
            var locale = $(this).attr('data-locale');
            default_category = $(this).attr('data-category');
            $('.locale_holder').text(locale);
            searchProduct(pid);
        });

        $('.searcher').on('keypress', function(e) {
            if (e.which == 13) {
                $('.ui.grid>.ui.dimmer').addClass('active');
                searchProduct($(this).val());
            }
        });

        searchProduct(default_pid);
    });

    function searchProduct(pid) {
        $.ajax({
            type: "GET",
            url: '/pd/' + $('.locale_holder').text() + '/' + pid,
            statusCode : {
                404: function() {
                    $('.ui.grid>.ui.dimmer').removeClass('active');
                }
            }
        }).done(function(products) {
            if (products && products.length > 0) {
                data = products;
                showProduct();
            } else {
                $('.ui.grid>.ui.dimmer').removeClass('active');
            }
        });
    }

    function showProduct() {
        $('.ui.breadcrumb').html('');
        $('.ui.breadcrumb')
                .append($('<a/>').addClass('section').append($('<i/>').addClass('circle left icon')).append(' Back')).append($('<div/>').addClass('divider').text('ï½œ'))
                .append($('<a/>').addClass('section').append('Home')).append($('<div/>').addClass('divider').text(' /'));

        var categories = default_category;
        _.each(categories.split(','), function(cat, index, list) {
            $('.ui.breadcrumb').append($('<a/>').addClass('section').append(cat)).append($('<div/>').addClass('divider').text(' /'));
        });

        $('.ui.breadcrumb').append($('<a/>').addClass('action section').append(data[0].displayName));

        $('.ui.variations').html('');
        var row;
        _.each(data, function(pd, index, all) {
            var content = $('<div></div>').addClass('content').addClass('content').on('click', function(e) {
                displayProduct(index);
            });
            if (index % 7 == 0) {
                row = $('<div/>').addClass('row');
                $('.ui.variations').append(row);
            }
            row.append(
                $('<div></div>').addClass('item').append(content)
            );
            var label = pd.extendAttributes['ext_msVarLabelOverride'];
            var pLabel = pd.extendAttributes['ext_msPDPVariationLabelOverride'];
            content.text(label ? label : (pLabel ? pLabel : 'BASE'));

        });

        displayProduct(0);
        $('.ui.grid>.ui.dimmer').removeClass('active');
    }

    function displayProduct(index) {
        var pd = data[index];
        var attrs = pd.extendAttributes;

        $('h3.ui.header').html($('<span></span>').text(pd.displayName).append($('<div></div>').addClass('sub header').append($('<span>' + attrs['ext_msPDPShortDescription'] +  '</span>'))));

        $('.description.tags').text(pd['sku']);
        $('.ui.price>.base_price').text(attrs['ext_msMSRP']);
        $('.ui.price>.list_price').text(attrs['ext_msListPrice']);

        $('.ui.thumbnails').html('');
        _.each(_.sortBy(_.filter(_.keys(attrs), function(name) { return /ext_PDPThumbnailImage/.test(name); })), function(imgKey) {
            var pindx = imgKey.substr('ext_PDPThumbnailImage'.length);
            $('.ui.thumbnails').append(
                    $('<div></div>').addClass('item').append(
                            $('<img/>').addClass('ui image right floated').attr('src', attrs[imgKey]))
                            .on('click', function(e) {
                                enlargePicture(index, pindx);
                            }));
        });

        enlargePicture(index, 1);
    }

    function enlargePicture(dataIndex, picIndex) {
        $('.ui.pdp>img').attr('src', data[dataIndex].extendAttributes['ext_PDPImageLarge' + picIndex]);
    }
</script>
</body>
</html>